# Server

## Опис модуля

Модуль `server` відповідає за створення, налаштування, запуск і зупинку HTTP-сервера на основі **Fiber**. Цей сервер забезпечує обробку запитів, маршрутизацію, інтеграцію middleware, а також взаємодію з іншими модулями (handlers, middleware).

---

## Основні компоненти

### Структура `Server`

```go
type Server struct {
    srv *fiber.App            // Основний екземпляр Fiber-сервера
    cfg *config.Config        // Конфігурація сервера
    h   *handlers.Handlers    // Зв'язок з обробниками запитів
    mdl *middleware.Middleware // Зв'язок з middleware
}
```
## Основні функції
### `NewServer`

Ініціалізує сервер із заданою конфігурацією, обробниками та middleware:

```go
func NewServer(config *config.Config, handlers *handlers.Handlers, midd *middleware.Middleware) *Server
```

### `Run`

Запускає сервер із такими етапами:
1. Конфігурація Fiber:
     - Назва програми: Delivery app ver 1.0.
     - Кастомна обробка помилок.
     - Інтеграція валідатора для перевірки даних.
2. Підключення middleware:
   - Логування HTTP-запитів.
   - Відновлення після помилок і панік.
   - Налаштування CORS для доступу клієнтів.
3. Ініціалізація маршрутів:
   - Налаштування API для користувачів, страв, замовлень та адміністраторів.
4. Запуск сервера:
```go
log.Fatal(s.srv.Listen(s.cfg.HostAddr + ":" + s.cfg.HostPort))
```
### `Stop`

Зупиняє сервер і закриває активні підключення:

```go
func (s *Server) Stop() {
    s.srv.Shutdown()
}

```

## Middleware
Підключені middleware:
- Logger: Логування HTTP-запитів.
- Recover: Захист від аварійних збоїв.
- CORS: Дозволяє доступ клієнтів до API з різних доменів.

Маршрути
1. Auth (автентифікація):

   - `POST /auth/login`: Вхід користувача.
   - `POST /auth/register`: Реєстрація нового користувача.

2. User (користувачі):

   - `PATCH /user/change`: Зміна даних користувача.
   - `PATCH /user/change_password`: Зміна пароля.
   - `DELETE /user/delete`: Видалення облікового запису.
   - `POST /user/logout`: Вихід із системи.
   - `GET /user/info`: Отримання інформації про профіль.
   - `PATCH /user/photo`: Оновлення фото профілю.

3. Dishes (страви):

   - `GET /dishes/`: Отримання списку всіх страв.
   - `GET /dishes/by_id/:dish_id`: Отримання страви за ID.
   - `POST /dishes/by_category`: Пошук страв за категорією.
   - `GET /dishes/search/:name`: Пошук страви за назвою.
   - `GET /dishes/categories`: Список категорій страв.

4. Admin (адміністратор):

   - `POST /secure/add`: Додавання нової страви.
   - `DELETE /secure/delete/:id`: Видалення страви за ID.
   - `PUT /secure/update`: Оновлення інформації про страву.
   - `POST /secure/add_category`: Додавання нової категорії.

5. User Orders (замовлення):

   - `POST /user/create_orde`r: Створення нового замовлення.
   - `DELETE /user/delete_order`/:orderId: Видалення замовлення.
   - `GET /user/orders`: Отримання списку замовлень користувача.

## Переваги
- Продуктивність: Fiber забезпечує швидку обробку HTTP-запитів.
- Модульна архітектура: Легке налаштування, розширення та інтеграція нових функцій.
- Безпека: Middleware забезпечує автентифікацію та захист API.
- Документація: Інтеграція з Swagger для розробників.

Модуль server є ядром сервісу, що об'єднує всі компоненти програми для забезпечення стабільної роботи. Його структура дозволяє легко адаптувати рішення під конкретні потреби проєкту.
